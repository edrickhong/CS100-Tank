


ARM Macro Assembler    Page 1 


    1 00000000         
    2 00000000                 INCLUDE          include.s
    1 00000000         
    2 00000000 4001800C 
                       Prescaler
                               equ              0X4001800C
    3 00000000 40018018 
                       Match0  equ              0X40018018
    4 00000000 4001801C 
                       Match1  equ              0X4001801C
    5 00000000 40018020 
                       Match2  equ              0X40018020
    6 00000000 400FC0C4 
                       Pconp   equ              0x400FC0C4
    7 00000000 40034000 
                       Adcr0   equ              0x40034000
    8 00000000 40034004 
                       Adgr    equ              0x40034004
    9 00000000 40018004 
                       Tcr     equ              0x40018004
   10 00000000 400FC1A8 
                       PclkSel0
                               equ              0x400FC1A8
   11 00000000 40018070 
                       CounterTimercr
                               equ              0x40018070  ;selects either tim
                                                            er or counter
   12 00000000 40018050 
                       LoadEnabler
                               equ              0X40018050  ; enables pwm match
                                                             registers
   13 00000000 40018014 
                       Matchcr equ              0x40018014
   14 00000000 4001804C 
                       PWMcr   equ              0x4001804C
   15 00000000         
   16 00000000         
   17 00000000         
   18 00000000         ;Pin select register
   19 00000000 4002C000 
                       PinSel0 equ              0x4002C000
   20 00000000 4002C004 
                       PinSel1 equ              0x4002C004
   21 00000000 4002C008 
                       PinSel2 equ              0x4002C008
   22 00000000 4002C00C 
                       PinSel3 equ              0x4002C00C
   23 00000000 4002C010 
                       PinSel4 equ              0x4002C010
   24 00000000 4002C01C 
                       PinSel7 equ              0x4002C01C
   25 00000000 4002C020 
                       PinSel8 equ              0x4002C020
   26 00000000 4002C024 
                       PinSel9 equ              0x4002C024
   27 00000000 4002C028 
                       PinSel10
                               equ              0x4002C028
   28 00000000         



ARM Macro Assembler    Page 2 


   29 00000000         
   30 00000000         ;This acts like a DDR
   31 00000000 2009C000 
                       DDR0    equ              0x2009C000
   32 00000000 2009C020 
                       DDR1    equ              0x2009C020
   33 00000000 2009C040 
                       DDR2    equ              0x2009C040
   34 00000000 2009C060 
                       DDR3    equ              0x2009C060
   35 00000000 2009C080 
                       DDR4    equ              0x2009C080
   36 00000000         
   37 00000000         
   38 00000000         
   39 00000000         ;This acts like PORT
   40 00000000 2009C014 
                       Port0   equ              0x2009C014
   41 00000000 2009C034 
                       Port1   equ              0x2009C034
   42 00000000 2009C054 
                       Port2   equ              0x2009C054
   43 00000000 2009C074 
                       Port3   equ              0x2009C074
   44 00000000 2009C094 
                       Port4   equ              0x2009C094
   45 00000000         
   46 00000000         
   47 00000000         ;This sets the built in pull up resistor
   48 00000000 4002C040 
                       PinMode0
                               equ              0x4002C040
   49 00000000 4002C044 
                       PinMode1
                               equ              0x4002C044
   50 00000000 4002C048 
                       PinMode2
                               equ              0x4002C048
   51 00000000 4002C04C 
                       PinMode3
                               equ              0x4002C04C
   52 00000000 4002C050 
                       PinMode4
                               equ              0x4002C050
   53 00000000 4002C054 
                       PinMode5
                               equ              0x4002C054
   54 00000000 4002C058 
                       PinMode6
                               equ              0x4002C058
   55 00000000 4002C05C 
                       PinMode7
                               equ              0x4002C05C
   56 00000000 4002C060 
                       PinMode8
                               equ              0x4002C060
   57 00000000 4002C064 
                       PinMode9
                               equ              0x4002C064



ARM Macro Assembler    Page 3 


   58 00000000         
   59 00000000         
   60 00000000         
   61 00000000         
   62 00000000                 MACRO
   63 00000000                 WRITEBITS        $BITS_TO_WRITE,$REGISTER_ADDY
   64 00000000                 MOV              R1,$BITS_TO_WRITE
   65 00000000                 LDR              R0,=$REGISTER_ADDY
   66 00000000                 STR              R1,[R0]
   67 00000000                 MEND
   68 00000000         
   69 00000000                 MACRO
   70 00000000                 SETBITS          $BITS_TO_SET,$REG_ADDY
   71 00000000                 LDR              R0,=$REG_ADDY
   72 00000000                 LDR              R1,[R0]
   73 00000000                 ORR              R1,R1,$BITS_TO_SET
   74 00000000                 STR              R1,[R0]
   75 00000000                 MEND
   76 00000000         
   77 00000000                 MACRO                        ;ME SMASHY R0,R1.
   78 00000000                 CLEARBITS        $BITS_TO_CLEAR,$REG_ADDY
   79 00000000                 LDR              R0,=$REG_ADDY
   80 00000000                 LDR              R1,[R0]
   81 00000000                 BIC              R1,R1,$BITS_TO_CLEAR
   82 00000000                 STR              R1,[R0]
   83 00000000                 MEND
   84 00000000         
   85 00000000         
   86 00000000         
   87 00000000         ;Not used
   88 00000000 2009C018 
                       FIOSET0 equ              0x2009C018
   89 00000000 2009C038 
                       FIOSET1 equ              0x2009C038
   90 00000000 2009C058 
                       FIOSET2 equ              0x2009C058
   91 00000000 2009C078 
                       FIOSET3 equ              0x2009C078
   92 00000000 2009C098 
                       FIOSET4 equ              0x2009C098
   93 00000000         
   94 00000000 2009C01C 
                       FIOCLR0 equ              0x2009C01C
   95 00000000 2009C03C 
                       FIOCLR1 equ              0x2009C03C
   96 00000000 2009C05C 
                       FIOCLR2 equ              0x2009C05C
   97 00000000 2009C07C 
                       FIOCLR3 equ              0x2009C07C
   98 00000000 2009C09C 
                       FIOCLR4 equ              0x2009C09C
   99 00000000         
  100 00000000         ;AREA DATAAREA, DATA ; HEY, ASSEMBLER: GIMME 16 bytes SP
                       ACE IN DATA MEMORY
  101 00000000         
  102 00000000                 END
    3 00000000         
    4 00000000 0000001E 
                       BaseSpeed



ARM Macro Assembler    Page 4 


                               equ              30          ;we will use 50 for
                                                             now cos why not
    5 00000000 00000032 
                       TurnSpeed
                               equ              50
    6 00000000 00000001 
                       Factor  equ              1
    7 00000000 00000001 
                       Range   equ              1
    8 00000000         
    9 00000000         
   10 00000000         ;We will be adjusting individual wheel speeds on the fly
                        to do the turning
   11 00000000         
   12 00000000                 GLOBAL           __main
   13 00000000                 AREA             Main, CODE, READONLY
   14 00000000                 ALIGN            2           ; MAKE SURE CODE DO
                                                            ESN'T START ON ODD 
                                                            BYTES
   15 00000000                 ENTRY
   16 00000000         
   17 00000000         
   18 00000000         __main
   19 00000000         
   20 00000000         ;these are the pins that control the motors. Set them to
                        output
   21 00000000 4889            ldr              r0,=DDR0
   22 00000002 F04F 010F       mov              r1,#2_1111
   23 00000006 6001            str              r1,[r0]
   24 00000008         
   25 00000008         
   26 00000008 F04F 0900       mov              r9,#0       ; we will store the
                                                             angle bias into r9
                                                            . This is a signed 
                                                            number
   27 0000000C         
   28 0000000C         
   29 0000000C         
   30 0000000C         
   31 0000000C F000 F8A0       bl               INIT_PWM
   32 00000010 F000 F8E2       bl               INIT_ADC
   33 00000014         
   34 00000014         
   35 00000014         
   36 00000014         
   37 00000014         ;r0 is my result register
   38 00000014         
   39 00000014         Handle_Input
   40 00000014         
   41 00000014 F000 F803       bl               Read_Sensor
   42 00000018         
   43 00000018         
   44 00000018 F000 F861       bl               Process     ; we will have Proc
                                                            ess over here inste
                                                            ad
   45 0000001C         
   46 0000001C E7FA            B                Handle_Input
   47 0000001E         
   48 0000001E         



ARM Macro Assembler    Page 5 


   49 0000001E         
   50 0000001E         
   51 0000001E         
   52 0000001E         Read_Sensor                          ;r1 r2 r3
   53 0000001E         
   54 0000001E                 SETBITS          #1,Adcr0    ;read pin 0
   71 0000001E 4883            LDR              R0,=Adcr0
   72 00000020 6801            LDR              R1,[R0]
   73 00000022 F041 0101       ORR              R1,R1,#1
   74 00000026 6001            STR              R1,[R0]
   55 00000028                 CLEARBITS        #(2_11111110),Adcr0
   79 00000028 4880            LDR              R0,=Adcr0
   80 0000002A 6801            LDR              R1,[R0]
   81 0000002C F021 01FE       BIC              R1,R1,#(2_11111110)
   82 00000030 6001            STR              R1,[R0]
   56 00000032         
   57 00000032                 SETBITS          #(1 << 24),Adcr0 ; START
   71 00000032 487E            LDR              R0,=Adcr0
   72 00000034 6801            LDR              R1,[R0]
   73 00000036 F041 7180       ORR              R1,R1,#(1 << 24)
   74 0000003A 6001            STR              R1,[R0]
   58 0000003C                 CLEARBITS        #(2_11 << 25),Adcr0
   79 0000003C 487B            LDR              R0,=Adcr0
   80 0000003E 6801            LDR              R1,[R0]
   81 00000040 F021 61C0       BIC              R1,R1,#(2_11 << 25)
   82 00000044 6001            STR              R1,[R0]
   59 00000046         
   60 00000046         
   61 00000046         ;load in the  ADGR register
   62 00000046         
   63 00000046 487A            LDR              R0,=Adgr
   64 00000048         
   65 00000048         
   66 00000048         ;check if conversion is complete
   67 00000048         Converting_Y                         ;Front
   68 00000048 6801            LDR              R1,[R0]
   69 0000004A F011 4F00       TST              R1,#(1 << 31)
   70 0000004E D0FB            BEQ              Converting_Y
   71 00000050         
   72 00000050         
   73 00000050         
   74 00000050 B402            push             {r1}
   75 00000052         
   76 00000052         
   77 00000052         Start_Converting_X                   ;Left
   78 00000052         
   79 00000052                 SETBITS          #2,Adcr0    ;read pin 0
   71 00000052 4876            LDR              R0,=Adcr0
   72 00000054 6801            LDR              R1,[R0]
   73 00000056 F041 0102       ORR              R1,R1,#2
   74 0000005A 6001            STR              R1,[R0]
   80 0000005C                 CLEARBITS        #(2_11111101),Adcr0
   79 0000005C 4873            LDR              R0,=Adcr0
   80 0000005E 6801            LDR              R1,[R0]
   81 00000060 F021 01FD       BIC              R1,R1,#(2_11111101)
   82 00000064 6001            STR              R1,[R0]
   81 00000066         
   82 00000066                 SETBITS          #(1 << 24),Adcr0 ; START
   71 00000066 4871            LDR              R0,=Adcr0



ARM Macro Assembler    Page 6 


   72 00000068 6801            LDR              R1,[R0]
   73 0000006A F041 7180       ORR              R1,R1,#(1 << 24)
   74 0000006E 6001            STR              R1,[R0]
   83 00000070                 CLEARBITS        #(2_11 << 25),Adcr0
   79 00000070 486E            LDR              R0,=Adcr0
   80 00000072 6801            LDR              R1,[R0]
   81 00000074 F021 61C0       BIC              R1,R1,#(2_11 << 25)
   82 00000078 6001            STR              R1,[R0]
   84 0000007A         ;load in the  ADGR register 
   85 0000007A         
   86 0000007A 486D            LDR              R0,=Adgr
   87 0000007C         
   88 0000007C         ;check if conversion is complete
   89 0000007C         
   90 0000007C         Converting_X
   91 0000007C 6801            LDR              R1,[R0]
   92 0000007E F011 4F00       TST              R1,#(1 << 31)
   93 00000082 D0FB            BEQ              Converting_X
   94 00000084         
   95 00000084 B402            push             {r1}
   96 00000086         
   97 00000086         Start_Converting_Z
   98 00000086         
   99 00000086                 SETBITS          #4,Adcr0    ;read pin 0
   71 00000086 4869            LDR              R0,=Adcr0
   72 00000088 6801            LDR              R1,[R0]
   73 0000008A F041 0104       ORR              R1,R1,#4
   74 0000008E 6001            STR              R1,[R0]
  100 00000090                 CLEARBITS        #(2_11111011),Adcr0
   79 00000090 4866            LDR              R0,=Adcr0
   80 00000092 6801            LDR              R1,[R0]
   81 00000094 F021 01FB       BIC              R1,R1,#(2_11111011)
   82 00000098 6001            STR              R1,[R0]
  101 0000009A         
  102 0000009A                 SETBITS          #(1 << 24),Adcr0 ; START
   71 0000009A 4864            LDR              R0,=Adcr0
   72 0000009C 6801            LDR              R1,[R0]
   73 0000009E F041 7180       ORR              R1,R1,#(1 << 24)
   74 000000A2 6001            STR              R1,[R0]
  103 000000A4                 CLEARBITS        #(2_11 << 25),Adcr0
   79 000000A4 4861            LDR              R0,=Adcr0
   80 000000A6 6801            LDR              R1,[R0]
   81 000000A8 F021 61C0       BIC              R1,R1,#(2_11 << 25)
   82 000000AC 6001            STR              R1,[R0]
  104 000000AE         
  105 000000AE         
  106 000000AE 4860            LDR              R0,=Adgr
  107 000000B0         
  108 000000B0         Converting_Z                         ;FIXME:Right  We ca
                                                            nnot seem to read f
                                                            rom here
  109 000000B0         
  110 000000B0 6801            LDR              R1,[R0]
  111 000000B2 F011 4F00       TST              R1,#(1 << 31)
  112 000000B6 D0FB            BEQ              Converting_Z
  113 000000B8         
  114 000000B8 B402            push             {r1}
  115 000000BA         
  116 000000BA         ;format the results r1 r2 r3



ARM Macro Assembler    Page 7 


  117 000000BA         
  118 000000BA         ;result is in r1
  119 000000BA         
  120 000000BA         ;shift the result right by 4
  121 000000BA         ;clear all other bits
  122 000000BA         
  123 000000BA BC08            pop              {r3}
  124 000000BC BC04            pop              {r2}
  125 000000BE BC02            pop              {r1}
  126 000000C0         
  127 000000C0 4C5C            ldr              r4,=0xFFFFF000
  128 000000C2         
  129 000000C2 EA4F 1121       ASR              r1,#4
  130 000000C6 EA21 0104       BIC              r1,r4       ;#2_1111 1111 1111 
                                                            1111 1111 0000 0000
                                                             0000
  131 000000CA         
  132 000000CA EA4F 1222       ASR              r2,#4
  133 000000CE EA22 0204       BIC              r2,r4
  134 000000D2         
  135 000000D2 EA4F 1323       ASR              r3,#4
  136 000000D6 EA23 0304       BIC              r3,r4
  137 000000DA         
  138 000000DA         
  139 000000DA BF00            nop
  140 000000DC         
  141 000000DC         
  142 000000DC         
  143 000000DC 4770            bx               lr
  144 000000DE         
  145 000000DE         
  146 000000DE         
  147 000000DE         
  148 000000DE         
  149 000000DE         Process
  150 000000DE         
  151 000000DE         ;r1 r2 and r3 are reserved  (Fs Ls Rs)
  152 000000DE         
  153 000000DE B500            push             {lr}
  154 000000E0         
  155 000000E0         
  156 000000E0         ;---------------Debug Sensors Start------------------
  157 000000E0         
  158 000000E0         
  159 000000E0 EBA2 0403       sub              r4,r2,r3    ; L - R
  160 000000E4         
  161 000000E4         
  162 000000E4 2C00            cmp              r4,#0
  163 000000E6 D50E            bpl              Forward_Right
  164 000000E8         
  165 000000E8         ;case r4 < 0, turn left
  166 000000E8         
  167 000000E8         ;right
  168 000000E8         
  169 000000E8 4853            ldr              r0,=Port0
  170 000000EA F04F 010A       mov              r1,#2_1010  ;#2_0101
  171 000000EE 6001            str              r1,[r0]
  172 000000F0         
  173 000000F0         



ARM Macro Assembler    Page 8 


  174 000000F0         ;reset to the base speed
  175 000000F0 4852            ldr              r0,= Match1
  176 000000F2 F04F 0132       mov              r1, #TurnSpeed
  177 000000F6 6001            str              r1,[r0]
  178 000000F8         
  179 000000F8 4851            ldr              r0,=Match2
  180 000000FA F04F 011E       mov              r1, #BaseSpeed
  181 000000FE 6001            str              r1,[r0]
  182 00000100         
  183 00000100 F109 0901       add              r9,#1
  184 00000104         
  185 00000104         ;------
  186 00000104         
  187 00000104 E01C            b                Process_Exit
  188 00000106         
  189 00000106         
  190 00000106         Forward_Right
  191 00000106         
  192 00000106 F240 756C       mov              r5,#1900
  193 0000010A 42AC            cmp              r4,r5
  194 0000010C D50A            bpl              Go_Forward
  195 0000010E         
  196 0000010E         ; r4 < r5
  197 0000010E         ;FORWARD
  198 0000010E 484A            ldr              r0,=Port0
  199 00000110 F04F 010A       mov              r1,#2_1010  ;#2_0101
  200 00000114 6001            str              r1,[r0]
  201 00000116         
  202 00000116         
  203 00000116         ;reset to the base speed
  204 00000116 4849            ldr              r0,= Match1
  205 00000118 F04F 011E       mov              r1, #BaseSpeed
  206 0000011C 6001            str              r1,[r0]
  207 0000011E         
  208 0000011E 4848            ldr              r0,=Match2
  209 00000120 6001            str              r1,[r0]
  210 00000122         ;----
  211 00000122 E00D            b                Process_Exit
  212 00000124         
  213 00000124         Go_Forward
  214 00000124         
  215 00000124         
  216 00000124         ; r4 >=r5
  217 00000124         
  218 00000124         ;left
  219 00000124         
  220 00000124 4844            ldr              r0,=Port0
  221 00000126 F04F 010A       mov              r1,#2_1010  ;#2_0101
  222 0000012A 6001            str              r1,[r0]
  223 0000012C         
  224 0000012C         
  225 0000012C         ;reset to the base speed
  226 0000012C 4843            ldr              r0,= Match1
  227 0000012E F04F 011E       mov              r1, #BaseSpeed
  228 00000132 6001            str              r1,[r0]
  229 00000134         
  230 00000134 4842            ldr              r0,=Match2
  231 00000136 F101 0132       add              r1, #TurnSpeed
  232 0000013A 6001            str              r1,[r0]



ARM Macro Assembler    Page 9 


  233 0000013C         
  234 0000013C F1A9 0901       sub              r9,#1
  235 00000140         
  236 00000140         
  237 00000140         ;----
  238 00000140         
  239 00000140         
  240 00000140         ;---------------Debug Sensors End------------------
  241 00000140         
  242 00000140         Process_Exit
  243 00000140         
  244 00000140 F85D EB04       pop              {lr}        ;restore return add
                                                            ress
  245 00000144         
  246 00000144         
  247 00000144                 SETBITS          #2_111,LoadEnabler 
                                                            ; latch the results
                                                            
   71 00000144 483F            LDR              R0,=LoadEnabler
   72 00000146 6801            LDR              R1,[R0]
   73 00000148 F041 0107       ORR              R1,R1,#2_111
   74 0000014C 6001            STR              R1,[R0]
  248 0000014E         
  249 0000014E 4770            bx               lr
  250 00000150         
  251 00000150         
  252 00000150         
  253 00000150         
  254 00000150         
  255 00000150         
  256 00000150         
  257 00000150         
  258 00000150         
  259 00000150         
  260 00000150         
  261 00000150         ;--------------Init stuff. This will be here untiil I fi
                       gure out how this assembler works-----------------------
                       --------
  262 00000150         
  263 00000150         
  264 00000150         
  265 00000150         ;NOTE: This should be fixed now. Please check
  266 00000150         
  267 00000150         ;we need to switch on the pwm. Get this done I guess  (p
                       2.0 and p2.1)
  268 00000150         
  269 00000150         INIT_PWM
  270 00000150                 SETBITS          #2_1000000,Pconp ;PWM POWER ON
   71 00000150 483D            LDR              R0,=Pconp
   72 00000152 6801            LDR              R1,[R0]
   73 00000154 F041 0140       ORR              R1,R1,#2_1000000
   74 00000158 6001            STR              R1,[R0]
  271 0000015A         
  272 0000015A         
  273 0000015A         ; 2. Reset and hold the PWM module  Set bit 1 at 0x4001 
                       8004.  (Timer Control Register)
  274 0000015A                 SETBITS          #2_10,Tcr
   71 0000015A 483C            LDR              R0,=Tcr
   72 0000015C 6801            LDR              R1,[R0]



ARM Macro Assembler    Page 10 


   73 0000015E F041 0102       ORR              R1,R1,#2_10
   74 00000162 6001            STR              R1,[R0]
  275 00000164         
  276 00000164         
  277 00000164         ;3. Peripheral clock: In the PCLKSEL0 register (Table 40
                       ), select PCLK_PWM1.  Set bit 12 at 0x400F C1A8 (Clock i
                       nput to PWM 1:1)
  278 00000164                 SETBITS          #0X1000,PclkSel0 ; (basically 1
                                                             << 12)
   71 00000164 483A            LDR              R0,=PclkSel0
   72 00000166 6801            LDR              R1,[R0]
   73 00000168 F441 5180       ORR              R1,R1,#0X1000
   74 0000016C 6001            STR              R1,[R0]
  279 0000016E         
  280 0000016E         
  281 0000016E         ;4. Pins: Select which pin the PWM1 attaches to through 
                       the PINSEL registers. Attach PWM1 to P2[0] where our spe
                       aker is.  PINSEL4, that is, 0x4002 C010 should have its 
                       least significant bits set to 01.
  282 0000016E                 SETBITS          #0101,PinSel4 ;sets pins 2.0 an
                                                            d 2.1 to pwm
   71 0000016E 4839            LDR              R0,=PinSel4
   72 00000170 6801            LDR              R1,[R0]
   73 00000172 F041 0165       ORR              R1,R1,#0101
   74 00000176 6001            STR              R1,[R0]
  283 00000178                 CLEARBITS        #2_1010,PinSel4 ;NOT EFFICIENT
   79 00000178 4836            LDR              R0,=PinSel4
   80 0000017A 6801            LDR              R1,[R0]
   81 0000017C F021 010A       BIC              R1,R1,#2_1010
   82 00000180 6001            STR              R1,[R0]
  284 00000182         
  285 00000182         
  286 00000182         ;5. Select pin modes for port pins with PWM1 functions t
                       hrough the PINMODE registers (Section 8.5). PINMODE4, se
                       nd Binary LSB 10 to 0x4002C050 so that the pin has neith
                       er a pull-up nor a pull-down resistor attached to it.
  287 00000182                 WRITEBITS        #2_1010,PinMode4 ;write 10
   64 00000182 F04F 010A       MOV              R1,#2_1010
   65 00000186 4834            LDR              R0,=PinMode4
   66 00000188 6001            STR              R1,[R0]
  288 0000018A         
  289 0000018A         
  290 0000018A         ;Now to set up the Period, Pulse Width, and finally enab
                       le PWM output.
  291 0000018A         ;6. Attach the system clock ->prescaler -> PWM -- write 
                       0x00000000 to the CounT Control Register (0x4001 8070).
  292 0000018A                 WRITEBITS        #0,CounterTimercr
   64 0000018A F04F 0100       MOV              R1,#0
   65 0000018E 4833            LDR              R0,=CounterTimercr
   66 00000190 6001            STR              R1,[R0]
  293 00000192         
  294 00000192         
  295 00000192         ;7. Set up the prescaler to count every 250 clock cycles
                        by storing 250 to the address of the Prescale Register 
                       (0x4001 800C)
  296 00000192         
  297 00000192         
  298 00000192         ;WRITEBITS #249,Prescaler
  299 00000192         



ARM Macro Assembler    Page 11 


  300 00000192                 WRITEBITS        #(0xF << 10),Prescaler
   64 00000192 F44F 5170       MOV              R1,#(0xF << 10)
   65 00000196 4832            LDR              R0,=Prescaler
   66 00000198 6001            STR              R1,[R0]
  301 0000019A         
  302 0000019A         
  303 0000019A         ;8. Set the PWM to reset when it reaches 100 counts by: 
                       (A) storing 100 in PWM1 Match Register 0 (0x4001 8018)
  304 0000019A                 WRITEBITS        #100,Match0
   64 0000019A F04F 0164       MOV              R1,#100
   65 0000019E 4831            LDR              R0,=Match0
   66 000001A0 6001            STR              R1,[R0]
  305 000001A2         
  306 000001A2         
  307 000001A2         ;9. Tell the PWM to turn off output when it reaches 50 b
                       y storing 50 in PWM1MatchRegister 1 (0x4001 801C)
  308 000001A2                 WRITEBITS        #50,Match1
   64 000001A2 F04F 0132       MOV              R1,#50
   65 000001A6 4825            LDR              R0,=Match1
   66 000001A8 6001            STR              R1,[R0]
  309 000001AA                 WRITEBITS        #50,Match2  ;And PWM1MatchRegis
                                                            ter 2
   64 000001AA F04F 0132       MOV              R1,#50
   65 000001AE 4824            LDR              R0,=Match2
   66 000001B0 6001            STR              R1,[R0]
  310 000001B2         
  311 000001B2         
  312 000001B2         ;10. (B)Update the PWM timing with Match0 and Match1  by
                        "latching" them in: load 11 to the LSB of (0x4001 8050)
                       
  313 000001B2         
  314 000001B2                 SETBITS          #2_111,LoadEnabler ;latch m0 m1
                                                             and m2 ;LoadEnable
                                                            r allows the values
                                                             written in match r
                                                            egisters to take af
                                                            fect in the next cl
                                                            ock cycle
   71 000001B2 4824            LDR              R0,=LoadEnabler
   72 000001B4 6801            LDR              R1,[R0]
   73 000001B6 F041 0107       ORR              R1,R1,#2_111
   74 000001BA 6001            STR              R1,[R0]
  315 000001BC         
  316 000001BC         
  317 000001BC         ;SETBITS #2_1111,LoadEnabler;And Match2 and Match3
  318 000001BC         
  319 000001BC         
  320 000001BC         ;11. (C)Make Match0 reset the PWM (Match0 is period) by 
                       sending #2_00010 to MatchControlReg (0x4001 8014)
  321 000001BC         
  322 000001BC                 WRITEBITS        #2,Matchcr
   64 000001BC F04F 0102       MOV              R1,#2
   65 000001C0 4829            LDR              R0,=Matchcr
   66 000001C2 6001            STR              R1,[R0]
  323 000001C4         
  324 000001C4         
  325 000001C4         
  326 000001C4         ;WRITEBITS #2_00010010,Matchcr
  327 000001C4         



ARM Macro Assembler    Page 12 


  328 000001C4         
  329 000001C4         ;12. Enable PWM1 to output using the PWM Control Registe
                       r by sending 1 to the 9th bit of (0x4001 804C) (you can 
                       store 0x00200)
  330 000001C4                 SETBITS          #(3 << 9),PWMcr ;enable Match1 
                                                            and Match2 to outpu
                                                            t a pwm signal
   71 000001C4 4829            LDR              R0,=PWMcr
   72 000001C6 6801            LDR              R1,[R0]
   73 000001C8 F441 61C0       ORR              R1,R1,#(3 << 9)
   74 000001CC 6001            STR              R1,[R0]
  331 000001CE         
  332 000001CE         
  333 000001CE         ;13. Start the timer that feeds the PWM by removing the 
                       reset, enabling and starting: send a #9 to the TimerCont
                       rolReg(0x4001 8004)
  334 000001CE                 WRITEBITS        #2_1001,Tcr
   64 000001CE F04F 0109       MOV              R1,#2_1001
   65 000001D2 481E            LDR              R0,=Tcr
   66 000001D4 6001            STR              R1,[R0]
  335 000001D6         
  336 000001D6         
  337 000001D6 4770            BX               LR
  338 000001D8         
  339 000001D8         
  340 000001D8         
  341 000001D8         INIT_ADC                             ;targeting pins : p
                                                            0.23 p0.24 p0.25  F
                                                            s Ls Rs
  342 000001D8         ;enable adc in pconp
  343 000001D8                 SETBITS          #(1 << 12),Pconp
   71 000001D8 481B            LDR              R0,=Pconp
   72 000001DA 6801            LDR              R1,[R0]
   73 000001DC F441 5180       ORR              R1,R1,#(1 << 12)
   74 000001E0 6001            STR              R1,[R0]
  344 000001E2         
  345 000001E2         
  346 000001E2         ;enable adc in the ad0cr register
  347 000001E2                 WRITEBITS        #(1 << 21),Adcr0
   64 000001E2 F44F 1100       MOV              R1,#(1 << 21)
   65 000001E6 4811            LDR              R0,=Adcr0
   66 000001E8 6001            STR              R1,[R0]
  348 000001EA         
  349 000001EA         
  350 000001EA         ;set the peripheral clock
  351 000001EA                 SETBITS          #(2_11 << 24),PclkSel0
   71 000001EA 4819            LDR              R0,=PclkSel0
   72 000001EC 6801            LDR              R1,[R0]
   73 000001EE F041 7140       ORR              R1,R1,#(2_11 << 24)
   74 000001F2 6001            STR              R1,[R0]
  352 000001F4                 SETBITS          #(1<<11),Adcr0 ; increase adc r
                                                            ead prescale by 8
   71 000001F4 480D            LDR              R0,=Adcr0
   72 000001F6 6801            LDR              R1,[R0]
   73 000001F8 F441 6100       ORR              R1,R1,#(1<<11)
   74 000001FC 6001            STR              R1,[R0]
  353 000001FE         
  354 000001FE         ;set the pimode-PINSEL to adc (i think the problem was h
                       ere. Actually, it is)



ARM Macro Assembler    Page 13 


  355 000001FE         
  356 000001FE                 CLEARBITS        #(2_111111 << 14),PinSel1
   79 000001FE 481C            LDR              R0,=PinSel1
   80 00000200 6801            LDR              R1,[R0]
   81 00000202 F421 217C       BIC              R1,R1,#(2_111111 << 14)
   82 00000206 6001            STR              R1,[R0]
  357 00000208                 SETBITS          #(2_010101 << 14),PinSel1 
                                                            ;2_0101
   71 00000208 4819            LDR              R0,=PinSel1
   72 0000020A 6801            LDR              R1,[R0]
   73 0000020C F441 21A8       ORR              R1,R1,#(2_010101 << 14)
   74 00000210 6001            STR              R1,[R0]
  358 00000212         
  359 00000212         
  360 00000212         ;No pullup no pull down
  361 00000212         
  362 00000212         
  363 00000212                 CLEARBITS        #(2_111111 << 14),PinMode1
   79 00000212 4818            LDR              R0,=PinMode1
   80 00000214 6801            LDR              R1,[R0]
   81 00000216 F421 217C       BIC              R1,R1,#(2_111111 << 14)
   82 0000021A 6001            STR              R1,[R0]
  364 0000021C                 SETBITS          #(2_101010 << 14),PinMode1 ;#0x
                                                            A8000      ;#0x2800
                                                            0
   71 0000021C 4815            LDR              R0,=PinMode1
   72 0000021E 6801            LDR              R1,[R0]
   73 00000220 F441 2128       ORR              R1,R1,#(2_101010 << 14)
   74 00000224 6001            STR              R1,[R0]
  365 00000226         
  366 00000226         
  367 00000226         
  368 00000226         
  369 00000226         
  370 00000226         
  371 00000226 4770            BX               LR
  372 00000228         
  373 00000228         
  374 00000228                 END
              2009C000 
              40034000 
              40034004 
              FFFFF000 
              2009C014 
              4001801C 
              40018020 
              40018050 
              400FC0C4 
              40018004 
              400FC1A8 
              4002C010 
              4002C050 
              40018070 
              4001800C 
              40018018 
              40018014 
              4001804C 
              4002C004 
              4002C044 



ARM Macro Assembler    Page 14 


Command Line: --debug --xref --cpu=Cortex-M3 --apcs=interwork --depend=.\object
s\main.d -o.\objects\main.o -IC:\Users\c.terence\Desktop\cs100-tank\RTE -IC:\Us
ers\c.terence\Desktop\cs100-tank\RTE\Device\LPC1769 -I"C:\Program Files (x86)\K
eil_uvision5\ARM\PACK\ARM\CMSIS\4.4.0\CMSIS\Include" -I"C:\Program Files (x86)\
Keil_uvision5\ARM\PACK\Keil\LPC1700_DFP\2.1.0\Device\Include" --predefine="__EV
AL SETA 1" --predefine="__UVISION_VERSION SETA 513" --predefine="_RTE_ SETA 1" 
--predefine="LPC175x_6x SETA 1" --list=.\listings\main.lst main.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

Converting_X 0000007C

Symbol: Converting_X
   Definitions
      At line 90 in file main.s
   Uses
      At line 93 in file main.s
Comment: Converting_X used once
Converting_Y 00000048

Symbol: Converting_Y
   Definitions
      At line 67 in file main.s
   Uses
      At line 70 in file main.s
Comment: Converting_Y used once
Converting_Z 000000B0

Symbol: Converting_Z
   Definitions
      At line 108 in file main.s
   Uses
      At line 112 in file main.s
Comment: Converting_Z used once
Forward_Right 00000106

Symbol: Forward_Right
   Definitions
      At line 190 in file main.s
   Uses
      At line 163 in file main.s
Comment: Forward_Right used once
Go_Forward 00000124

Symbol: Go_Forward
   Definitions
      At line 213 in file main.s
   Uses
      At line 194 in file main.s
Comment: Go_Forward used once
Handle_Input 00000014

Symbol: Handle_Input
   Definitions
      At line 39 in file main.s
   Uses
      At line 46 in file main.s
Comment: Handle_Input used once
INIT_ADC 000001D8

Symbol: INIT_ADC
   Definitions
      At line 341 in file main.s
   Uses
      At line 32 in file main.s
Comment: INIT_ADC used once
INIT_PWM 00000150

Symbol: INIT_PWM



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 269 in file main.s
   Uses
      At line 31 in file main.s
Comment: INIT_PWM used once
Main 00000000

Symbol: Main
   Definitions
      At line 13 in file main.s
   Uses
      None
Comment: Main unused
Process 000000DE

Symbol: Process
   Definitions
      At line 149 in file main.s
   Uses
      At line 44 in file main.s
Comment: Process used once
Process_Exit 00000140

Symbol: Process_Exit
   Definitions
      At line 242 in file main.s
   Uses
      At line 187 in file main.s
      At line 211 in file main.s

Read_Sensor 0000001E

Symbol: Read_Sensor
   Definitions
      At line 52 in file main.s
   Uses
      At line 41 in file main.s
Comment: Read_Sensor used once
Start_Converting_X 00000052

Symbol: Start_Converting_X
   Definitions
      At line 77 in file main.s
   Uses
      None
Comment: Start_Converting_X unused
Start_Converting_Z 00000086

Symbol: Start_Converting_Z
   Definitions
      At line 97 in file main.s
   Uses
      None
Comment: Start_Converting_Z unused
__main 00000000

Symbol: __main
   Definitions
      At line 18 in file main.s



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Relocatable symbols

   Uses
      At line 12 in file main.s
Comment: __main used once
15 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

Adcr0 40034000

Symbol: Adcr0
   Definitions
      At line 7 in file include.s
   Uses
      At line 71 in macro ÿÿTBITS
      at line 54 in file main.s
      At line 79 in macro >EARBITS
      at line 55 in file main.s
      At line 65 in macro ÿÿITEBITS
      at line 347 in file main.s

Adgr 40034004

Symbol: Adgr
   Definitions
      At line 8 in file include.s
   Uses
      At line 63 in file main.s
      At line 86 in file main.s
      At line 106 in file main.s

BaseSpeed 0000001E

Symbol: BaseSpeed
   Definitions
      At line 4 in file main.s
   Uses
      At line 180 in file main.s
      At line 205 in file main.s
      At line 227 in file main.s

CounterTimercr 40018070

Symbol: CounterTimercr
   Definitions
      At line 11 in file include.s
   Uses
      At line 65 in macro ÿÿITEBITS
      at line 292 in file main.s
Comment: CounterTimercr used once
DDR0 2009C000

Symbol: DDR0
   Definitions
      At line 31 in file include.s
   Uses
      At line 21 in file main.s
Comment: DDR0 used once
DDR1 2009C020

Symbol: DDR1
   Definitions
      At line 32 in file include.s
   Uses
      None
Comment: DDR1 unused
DDR2 2009C040



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols


Symbol: DDR2
   Definitions
      At line 33 in file include.s
   Uses
      None
Comment: DDR2 unused
DDR3 2009C060

Symbol: DDR3
   Definitions
      At line 34 in file include.s
   Uses
      None
Comment: DDR3 unused
DDR4 2009C080

Symbol: DDR4
   Definitions
      At line 35 in file include.s
   Uses
      None
Comment: DDR4 unused
FIOCLR0 2009C01C

Symbol: FIOCLR0
   Definitions
      At line 94 in file include.s
   Uses
      None
Comment: FIOCLR0 unused
FIOCLR1 2009C03C

Symbol: FIOCLR1
   Definitions
      At line 95 in file include.s
   Uses
      None
Comment: FIOCLR1 unused
FIOCLR2 2009C05C

Symbol: FIOCLR2
   Definitions
      At line 96 in file include.s
   Uses
      None
Comment: FIOCLR2 unused
FIOCLR3 2009C07C

Symbol: FIOCLR3
   Definitions
      At line 97 in file include.s
   Uses
      None
Comment: FIOCLR3 unused
FIOCLR4 2009C09C

Symbol: FIOCLR4
   Definitions



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

      At line 98 in file include.s
   Uses
      None
Comment: FIOCLR4 unused
FIOSET0 2009C018

Symbol: FIOSET0
   Definitions
      At line 88 in file include.s
   Uses
      None
Comment: FIOSET0 unused
FIOSET1 2009C038

Symbol: FIOSET1
   Definitions
      At line 89 in file include.s
   Uses
      None
Comment: FIOSET1 unused
FIOSET2 2009C058

Symbol: FIOSET2
   Definitions
      At line 90 in file include.s
   Uses
      None
Comment: FIOSET2 unused
FIOSET3 2009C078

Symbol: FIOSET3
   Definitions
      At line 91 in file include.s
   Uses
      None
Comment: FIOSET3 unused
FIOSET4 2009C098

Symbol: FIOSET4
   Definitions
      At line 92 in file include.s
   Uses
      None
Comment: FIOSET4 unused
Factor 00000001

Symbol: Factor
   Definitions
      At line 6 in file main.s
   Uses
      None
Comment: Factor unused
LoadEnabler 40018050

Symbol: LoadEnabler
   Definitions
      At line 12 in file include.s
   Uses
      At line 71 in macro ÿÿTBITS



ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Absolute symbols

      at line 247 in file main.s
Comment: LoadEnabler used once
Match0 40018018

Symbol: Match0
   Definitions
      At line 3 in file include.s
   Uses
      At line 65 in macro ÿÿITEBITS
      at line 304 in file main.s
Comment: Match0 used once
Match1 4001801C

Symbol: Match1
   Definitions
      At line 4 in file include.s
   Uses
      At line 175 in file main.s
      At line 204 in file main.s
      At line 226 in file main.s
      At line 65 in macro ÿÿITEBITS
      at line 308 in file main.s

Match2 40018020

Symbol: Match2
   Definitions
      At line 5 in file include.s
   Uses
      At line 179 in file main.s
      At line 208 in file main.s
      At line 230 in file main.s
      At line 65 in macro ÿÿITEBITS
      at line 309 in file main.s

Matchcr 40018014

Symbol: Matchcr
   Definitions
      At line 13 in file include.s
   Uses
      At line 65 in macro ÿÿITEBITS
      at line 322 in file main.s
Comment: Matchcr used once
PWMcr 4001804C

Symbol: PWMcr
   Definitions
      At line 14 in file include.s
   Uses
      At line 71 in macro ÿÿTBITS
      at line 330 in file main.s
Comment: PWMcr used once
PclkSel0 400FC1A8

Symbol: PclkSel0
   Definitions
      At line 10 in file include.s
   Uses



ARM Macro Assembler    Page 5 Alphabetic symbol ordering
Absolute symbols

      At line 71 in macro ÿÿTBITS
      at line 278 in file main.s
Comment: PclkSel0 used once
Pconp 400FC0C4

Symbol: Pconp
   Definitions
      At line 6 in file include.s
   Uses
      At line 71 in macro ÿÿTBITS
      at line 270 in file main.s
Comment: Pconp used once
PinMode0 4002C040

Symbol: PinMode0
   Definitions
      At line 48 in file include.s
   Uses
      None
Comment: PinMode0 unused
PinMode1 4002C044

Symbol: PinMode1
   Definitions
      At line 49 in file include.s
   Uses
      At line 79 in macro >EARBITS
      at line 363 in file main.s
      At line 71 in macro ÿÿTBITS
      at line 364 in file main.s

PinMode2 4002C048

Symbol: PinMode2
   Definitions
      At line 50 in file include.s
   Uses
      None
Comment: PinMode2 unused
PinMode3 4002C04C

Symbol: PinMode3
   Definitions
      At line 51 in file include.s
   Uses
      None
Comment: PinMode3 unused
PinMode4 4002C050

Symbol: PinMode4
   Definitions
      At line 52 in file include.s
   Uses
      At line 65 in macro ÿÿITEBITS
      at line 287 in file main.s
Comment: PinMode4 used once
PinMode5 4002C054

Symbol: PinMode5



ARM Macro Assembler    Page 6 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 53 in file include.s
   Uses
      None
Comment: PinMode5 unused
PinMode6 4002C058

Symbol: PinMode6
   Definitions
      At line 54 in file include.s
   Uses
      None
Comment: PinMode6 unused
PinMode7 4002C05C

Symbol: PinMode7
   Definitions
      At line 55 in file include.s
   Uses
      None
Comment: PinMode7 unused
PinMode8 4002C060

Symbol: PinMode8
   Definitions
      At line 56 in file include.s
   Uses
      None
Comment: PinMode8 unused
PinMode9 4002C064

Symbol: PinMode9
   Definitions
      At line 57 in file include.s
   Uses
      None
Comment: PinMode9 unused
PinSel0 4002C000

Symbol: PinSel0
   Definitions
      At line 19 in file include.s
   Uses
      None
Comment: PinSel0 unused
PinSel1 4002C004

Symbol: PinSel1
   Definitions
      At line 20 in file include.s
   Uses
      At line 79 in macro >EARBITS
      at line 356 in file main.s
      At line 71 in macro ÿÿTBITS
      at line 357 in file main.s

PinSel10 4002C028

Symbol: PinSel10



ARM Macro Assembler    Page 7 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 27 in file include.s
   Uses
      None
Comment: PinSel10 unused
PinSel2 4002C008

Symbol: PinSel2
   Definitions
      At line 21 in file include.s
   Uses
      None
Comment: PinSel2 unused
PinSel3 4002C00C

Symbol: PinSel3
   Definitions
      At line 22 in file include.s
   Uses
      None
Comment: PinSel3 unused
PinSel4 4002C010

Symbol: PinSel4
   Definitions
      At line 23 in file include.s
   Uses
      At line 71 in macro ÿÿTBITS
      at line 282 in file main.s
      At line 79 in macro >EARBITS
      at line 283 in file main.s

PinSel7 4002C01C

Symbol: PinSel7
   Definitions
      At line 24 in file include.s
   Uses
      None
Comment: PinSel7 unused
PinSel8 4002C020

Symbol: PinSel8
   Definitions
      At line 25 in file include.s
   Uses
      None
Comment: PinSel8 unused
PinSel9 4002C024

Symbol: PinSel9
   Definitions
      At line 26 in file include.s
   Uses
      None
Comment: PinSel9 unused
Port0 2009C014

Symbol: Port0



ARM Macro Assembler    Page 8 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 40 in file include.s
   Uses
      At line 169 in file main.s
      At line 198 in file main.s
      At line 220 in file main.s

Port1 2009C034

Symbol: Port1
   Definitions
      At line 41 in file include.s
   Uses
      None
Comment: Port1 unused
Port2 2009C054

Symbol: Port2
   Definitions
      At line 42 in file include.s
   Uses
      None
Comment: Port2 unused
Port3 2009C074

Symbol: Port3
   Definitions
      At line 43 in file include.s
   Uses
      None
Comment: Port3 unused
Port4 2009C094

Symbol: Port4
   Definitions
      At line 44 in file include.s
   Uses
      None
Comment: Port4 unused
Prescaler 4001800C

Symbol: Prescaler
   Definitions
      At line 2 in file include.s
   Uses
      At line 65 in macro ÿÿITEBITS
      at line 300 in file main.s
Comment: Prescaler used once
Range 00000001

Symbol: Range
   Definitions
      At line 7 in file main.s
   Uses
      None
Comment: Range unused
Tcr 40018004

Symbol: Tcr



ARM Macro Assembler    Page 9 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 9 in file include.s
   Uses
      At line 71 in macro ÿÿTBITS
      at line 274 in file main.s
      At line 65 in macro ÿÿITEBITS
      at line 334 in file main.s

TurnSpeed 00000032

Symbol: TurnSpeed
   Definitions
      At line 5 in file main.s
   Uses
      At line 176 in file main.s
      At line 231 in file main.s

56 symbols
407 symbols in table
